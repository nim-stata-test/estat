<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESTAT Phase 2: EDA Report</title>
    <style>

:root {
    --primary-green: #2a9749;
    --primary-dark-blue: #1e4557;
    --accent-blue: #079bca;
    --purple: #9156b4;
    --light-green: #ddecde;
    --dark-teal: #146c8b;
    --gray-light: #f8f8f8;
    --gray-border: #e3e3e3;
    --gray-medium: #bababa;
    --gray-dark: #949494;
    --text: #333;
    --red-alert: #ff3a1f;
}

* {
    box-sizing: border-box;
}

body {
    font-family: Inter, "Helvetica Neue", Helvetica, Arial, sans-serif;
    font-size: 16px;
    line-height: 1.6;
    color: var(--text);
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 20px;
    background-color: #fafafa;
}

h1 {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary-dark-blue);
    margin-top: 0;
    margin-bottom: 1rem;
    border-bottom: 3px solid var(--primary-green);
    padding-bottom: 0.5rem;
}

h2 {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--primary-dark-blue);
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    border-bottom: 2px solid var(--gray-border);
    padding-bottom: 0.25rem;
}

h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--dark-teal);
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
}

h4 {
    font-size: 1rem;
    font-weight: 600;
    color: var(--primary-dark-blue);
    margin-top: 1.25rem;
    margin-bottom: 0.5rem;
}

p {
    margin-bottom: 1rem;
}

a {
    color: var(--primary-dark-blue);
    text-decoration: none;
    transition: color 0.15s ease;
}

a:hover {
    color: var(--accent-blue);
    text-decoration: underline;
}

a:visited {
    color: var(--purple);
}

/* Tables */
table {
    border-collapse: collapse;
    width: 100%;
    margin: 1.5rem 0;
    font-size: 0.9rem;
    background-color: white;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    border-radius: 4px;
    overflow: hidden;
}

th {
    background-color: var(--gray-light);
    color: var(--primary-green);
    font-weight: 600;
    text-align: left;
    padding: 12px 16px;
    border-bottom: 2px solid var(--text);
}

td {
    padding: 10px 16px;
    border-bottom: 1px solid var(--gray-border);
}

tr:last-child td {
    border-bottom: none;
}

tr:hover {
    background-color: var(--light-green);
}

/* Code blocks */
pre, code {
    font-family: "SF Mono", Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: 0.875rem;
}

code {
    background-color: var(--gray-light);
    padding: 2px 6px;
    border-radius: 4px;
    color: var(--dark-teal);
}

pre {
    background-color: var(--primary-dark-blue);
    color: #f0f0f0;
    padding: 16px 20px;
    border-radius: 4px;
    overflow-x: auto;
    margin: 1rem 0;
}

pre code {
    background: none;
    padding: 0;
    color: inherit;
}

/* Alert boxes */
.info {
    background-color: var(--light-green);
    border-left: 4px solid var(--primary-green);
    padding: 12px 16px;
    margin: 1rem 0;
    border-radius: 0 4px 4px 0;
}

.warning {
    background-color: #fff8e6;
    border-left: 4px solid #f0ad4e;
    padding: 12px 16px;
    margin: 1rem 0;
    border-radius: 0 4px 4px 0;
}

.error {
    background-color: #fdeaea;
    border-left: 4px solid var(--red-alert);
    padding: 12px 16px;
    margin: 1rem 0;
    border-radius: 0 4px 4px 0;
}

.recommendation {
    background-color: var(--light-green);
    border-left: 4px solid var(--primary-green);
    padding: 12px 16px;
    margin: 1rem 0;
    border-radius: 0 4px 4px 0;
}

/* Summary boxes */
.summary {
    background-color: white;
    border: 1px solid var(--gray-border);
    border-radius: 4px;
    padding: 20px;
    margin: 1.5rem 0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.summary h3 {
    margin-top: 0;
    color: var(--primary-green);
}

/* Metric cards */
.metrics {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin: 1.5rem 0;
}

.metric {
    background-color: white;
    border: 1px solid var(--gray-border);
    border-radius: 4px;
    padding: 16px;
    text-align: center;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

.metric-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary-green);
    line-height: 1.2;
}

.metric-label {
    font-size: 0.875rem;
    color: var(--gray-dark);
    margin-top: 4px;
}

/* Figures */
figure {
    margin: 1.5rem 0;
    text-align: center;
}

figure img {
    max-width: 100%;
    height: auto;
    border-radius: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

figcaption {
    font-size: 0.875rem;
    color: var(--gray-dark);
    margin-top: 8px;
    font-style: italic;
}

/* Lists */
ul, ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
}

li {
    margin-bottom: 0.5rem;
}

/* Footer */
.footer {
    margin-top: 3rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--gray-border);
    font-size: 0.875rem;
    color: var(--gray-dark);
    text-align: center;
}

/* Print styles */
@media print {
    body {
        background-color: white;
        max-width: none;
        padding: 0;
    }

    .no-print {
        display: none;
    }

    table {
        box-shadow: none;
    }

    pre {
        white-space: pre-wrap;
    }
}

/* Responsive adjustments */
@media (max-width: 768px) {
    body {
        padding: 20px 16px;
    }

    h1 {
        font-size: 1.75rem;
    }

    h2 {
        font-size: 1.5rem;
    }

    table {
        font-size: 0.8rem;
    }

    th, td {
        padding: 8px 10px;
    }
}


        .container { max-width: 1400px; margin: 0 auto; }
        .meta { color: #949494; margin-bottom: 2rem; }
        .card {
            background: white;
            border-radius: 4px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
        .stat-box {
            background: white;
            border-radius: 4px;
            padding: 1rem 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-box .value { font-size: 1.75rem; font-weight: bold; color: #2a9749; }
        .stat-box .label { color: #949494; font-size: 0.875rem; }
        .success { color: #2a9749; }
        .error { color: #ff3a1f; }
        .toc { background: white; padding: 1.5rem; border-radius: 4px; margin-bottom: 2rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .toc ul { list-style: none; margin: 0; }
        .toc li { margin: 0.5rem 0; }
        .toc h2 { margin-top: 0; border-bottom: none; color: #146c8b; }
        .figure {
            background: white;
            border-radius: 4px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .figure img { width: 100%; height: auto; border-radius: 4px; }
        .figure-caption { color: #949494; font-size: 0.875rem; margin-top: 0.5rem; text-align: center; }
        .figure.missing { border: 2px dashed #ff3a1f; }
        details { margin: 1rem 0; }
        summary {
            cursor: pointer;
            padding: 0.5rem;
            background: #f8f8f8;
            border-radius: 4px;
            font-weight: 500;
        }
        summary:hover { background: #e3e3e3; }
        .config-section {
            background: #ddecde;
            border-left: 4px solid #2a9749;
            padding: 1rem 1.5rem;
            margin: 1rem 0;
            border-radius: 0 4px 4px 0;
        }
    
    </style>
</head>
<body>
    <div class="container">
        <h1>ESTAT Phase 2: Exploratory Data Analysis Report</h1>
        <p class="meta">Generated: 2026-01-18 10:05:58</p>

        <div class="toc">
            <strong>Contents</strong>
            <ul>
                <li><a href="#overview">1. Overview</a></li>
                <li><a href="#config">2. Configuration</a></li>
                <li><a href="#quality">3. Data Quality Notes</a></li>
                <li><a href="#energy">4. Energy Patterns</a></li>
                <li><a href="#heating">5. Heating System</a></li>
                <li style="margin-left: 1rem;"><a href="#cop-models">5.1 COP Model Specification</a></li>
                <li><a href="#solar">6. Solar-Heating Correlation</a></li>
                <li><a href="#summary">7. Summary Statistics</a></li>
                <li><a href="#heating-curve">8. Heating Curve Analysis</a></li>
                <li><a href="#weighted-temp">9. Weighted Temperature Analysis</a></li>
                <li><a href="#tariffs">10. Electricity Tariffs</a></li>
                <li><a href="#hk2-target-actual">11. HK2 Target vs Actual Analysis</a></li>
                <li><a href="#sensor-exploration">12. Sensor Exploration</a></li>
                <li><a href="#battery">13. Battery Degradation</a></li>
                <li><a href="#log">14. Detailed Log</a></li>
            </ul>
        </div>

        <h2 id="overview">1. Overview</h2>

        <div class="grid">
            <div class="stat-box">
                <div class="value">55.9</div>
                <div class="label">kWh/day PV Generation</div>
            </div>
            <div class="stat-box">
                <div class="value">24.6</div>
                <div class="label">kWh/day Consumption</div>
            </div>
            <div class="stat-box">
                <div class="value">44%</div>
                <div class="label">Self-Sufficiency</div>
            </div>
            <div class="stat-box">
                <div class="value">3.48</div>
                <div class="label">Mean Heat Pump COP</div>
            </div>
        </div>

        <div class="card">
            <h4>Heat Pump Performance</h4>
            <table>
                <tr><td>Mean COP</td><td><strong>3.48</strong></td></tr>
                <tr><td>COP Range</td><td>2.34 - 5.18</td></tr>
                <tr><td>Mean Heating Electricity</td><td>25.7 kWh/day</td></tr>
                <tr><td>Max Heating Electricity</td><td>58.0 kWh/day</td></tr>
            </table>
        </div>

        <h2 id="config">2. Configuration</h2>

        <div class="config-section">
            <h4>Room Sensor Configuration</h4>
            <p>The following configuration was applied to room sensors for this analysis:</p>

            <h4>Excluded Sensors</h4>
            <p>These sensors were excluded (not actual room temperatures):</p>
            <ul><li>temphum_woz_temperature</li><li>motion_gang_2_temperature</li><li>motion_halle_n_temperature</li><li>outfeeler_temperature</li></ul>

            <h4>Sensor Mappings</h4>
            <p>These sensors were renamed (same physical sensor, renamed over time):</p>
            <ul><li>office2_temperature → atelier_temperature</li><li>office2_humidity → atelier_humidity</li></ul>

            <details>
                <summary>Primary Room Sensors Used</summary>
                <ul><li>atelier_temperature</li><li>bric_temperature</li><li>dorme_temperature</li><li>halle_temperature</li><li>office1_temperature</li><li>simlab_temperature</li><li>studio_temperature</li><li>guest_temperature</li><li>temp_cave</li><li>temphum_plant_temperature</li><li>temphum_bano_temperature</li><li>davis_inside_temperature</li></ul>
            </details>
        </div>

        <h2 id="quality">3. Data Quality Notes</h2>

        <div class="card">
            <h4>COP Calculation Methodology</h4>
            <p>Daily Coefficient of Performance (COP) is calculated as:</p>
            <pre style="background: var(--card-bg); color: var(--text); padding: 0.5rem;">COP = produced_heating / consumed_heating</pre>
            <p>Where both values are daily deltas from cumulative counter sensors.</p>

            <h4>Overlapping Time Window Filter</h4>
            <p>To ensure accurate COP calculations, daily values are computed only from <strong>overlapping time periods</strong>
            where both <code>consumed_heating</code> and <code>produced_heating</code> sensors have data.</p>
            <ul>
                <li>Days with less than 20 hours of sensor overlap are excluded</li>
                <li>This prevents artificially low COP values when one sensor has data gaps (e.g., after spike removal in preprocessing)</li>
                <li>Example: If spike removal creates a gap in <code>produced_heating</code> until noon, but <code>consumed_heating</code>
                has data from midnight, only the noon-to-midnight overlap is used for that day's calculation</li>
            </ul>

            <h4>Additional Filters</h4>
            <ul>
                <li>Negative delta values are excluded (sensor reset/error)</li>
                <li>Daily consumed &gt; 100 kWh excluded (unrealistic)</li>
                <li>Daily produced &gt; 500 kWh excluded (unrealistic)</li>
                <li>COP &lt; 1 or &gt; 10 excluded (physically impossible for heat pump)</li>
            </ul>
        </div>

        <div class="card">
            <h4>Glossary of Terms</h4>
            <table>
                <tr>
                    <td><strong>COP (Coefficient of Performance)</strong></td>
                    <td>
                        <p>The efficiency metric for heat pumps, defined as the ratio of useful heat energy delivered to electrical energy consumed:</p>
                        <pre style="background: var(--card-bg); color: var(--text); padding: 0.5rem; margin: 0.5rem 0;">COP = Heat Output (kWh) / Electrical Input (kWh)</pre>
                        <p>A COP of 3.5 means for every 1 kWh of electricity consumed, 3.5 kWh of heat is delivered to the building.
                        The "extra" energy comes from the outdoor air (or ground), which the heat pump extracts and concentrates.</p>
                        <p><strong>Factors affecting COP:</strong></p>
                        <ul>
                            <li><em>Outdoor temperature:</em> COP decreases as outdoor temp drops (less heat available to extract).
                            At 10°C outdoor, COP might be 4.5; at -5°C, it might drop to 2.5.</li>
                            <li><em>Flow temperature:</em> Higher heating circuit temperatures (e.g., for radiators vs underfloor) reduce COP.</li>
                            <li><em>Defrost cycles:</em> In cold/humid conditions, the outdoor unit frosts up and needs periodic defrosting, reducing effective COP.</li>
                        </ul>
                        <p><strong>Interpretation:</strong> COP &lt; 1 is impossible (would violate thermodynamics). COP of 1 equals resistive heating.
                        Modern air-source heat pumps typically achieve seasonal average COP of 2.5–4.0. Values above 5 are excellent but rare.</p>
                    </td>
                </tr>
                <tr>
                    <td><strong>Heating Degree Days (HDD)</strong></td>
                    <td>
                        <p>A weather-based metric that quantifies heating demand. For each day, HDD is calculated as:</p>
                        <pre style="background: var(--card-bg); color: var(--text); padding: 0.5rem; margin: 0.5rem 0;">HDD = max(0, T_base - T_outdoor_avg)</pre>
                        <p>Where <code>T_base</code> is the balance point temperature (15°C in this analysis) below which heating is typically needed,
                        and <code>T_outdoor_avg</code> is the average outdoor temperature for that day.</p>
                        <p><strong>Examples:</strong></p>
                        <ul>
                            <li>Outdoor avg = 5°C → HDD = 15 - 5 = <strong>10</strong> (cold day, significant heating needed)</li>
                            <li>Outdoor avg = 12°C → HDD = 15 - 12 = <strong>3</strong> (mild day, some heating needed)</li>
                            <li>Outdoor avg = 18°C → HDD = max(0, 15 - 18) = <strong>0</strong> (warm day, no heating needed)</li>
                        </ul>
                        <p><strong>Usage:</strong> HDD allows comparison of heating consumption across different weather conditions.
                        A well-insulated building uses fewer kWh per HDD. The slope of the "Heating vs HDD" plot indicates building thermal performance:
                        steeper slope = more energy needed per degree of temperature difference = poorer insulation or higher heat loss.</p>
                    </td>
                </tr>
                <tr>
                    <td><strong>Forced Grid Consumption</strong></td>
                    <td>Periods when the heat pump is running but must draw electricity from the grid because:
                    (1) no solar PV is available (night/cloudy), and (2) battery is empty or insufficient.
                    This represents unavoidable grid dependency. Minimizing forced grid consumption is a key optimization goal.</td>
                </tr>
                <tr>
                    <td><strong>Self-Sufficiency</strong></td>
                    <td>The percentage of total consumption that comes directly from solar PV (not from grid or battery).
                    Calculated as: <code>direct_consumption / total_consumption</code>.
                    Higher is better. 100% means all energy used came directly from PV at time of generation.</td>
                </tr>
                <tr>
                    <td><strong>Solar Hours</strong></td>
                    <td>Defined as 8:00–17:00 (8 AM to 5 PM) when meaningful solar generation is typically available.
                    Used to analyze heating patterns relative to PV availability.</td>
                </tr>
            </table>
        </div>

        <h2 id="energy">4. Energy Patterns</h2>

        
            <div class="figure">
                <img src="fig2.01_daily_energy_timeseries.png" alt="Daily PV generation, consumption, grid interaction, and battery activity over time">
                <div class="figure-caption">Daily PV generation, consumption, grid interaction, and battery activity over time</div>
            </div>
            
            <div class="figure">
                <img src="fig2.02_monthly_energy_patterns.png" alt="Monthly aggregated energy patterns, grid balance, and self-sufficiency">
                <div class="figure-caption">Monthly aggregated energy patterns, grid balance, and self-sufficiency</div>
            </div>
            
            <div class="figure">
                <img src="fig2.03_hourly_heatmaps.png" alt="Average consumption, PV generation, and grid import by hour and day of week">
                <div class="figure-caption">Average consumption, PV generation, and grid import by hour and day of week</div>
            </div>
            
            <div class="figure">
                <img src="fig2.04_seasonal_patterns.png" alt="Seasonal comparison of PV generation, consumption, and self-sufficiency">
                <div class="figure-caption">Seasonal comparison of PV generation, consumption, and self-sufficiency</div>
            </div>
            
            <div class="figure">
                <img src="

        <h2 id="heating">5. Heating System</h2>

        
            
            <div class="figure">
                <img src="fig2.05_heat_pump_cop.png" alt="Heat pump COP analysis: time series, vs outdoor temperature, consumption patterns">
                <div class="figure-caption">Heat pump COP analysis: time series, vs outdoor temperature, consumption patterns
            
            <div class="figure">
                <img src="fig2.06_temperature_differentials.png" alt="Flow/return temperatures, buffer tank, and heating circuits">
                <div class="figure-caption">Flow/return temperatures, buffer tank, and heating circuits
            
            <div class="figure">
                <img src="fig2.07_indoor_outdoor_temp.png" alt="Outdoor vs indoor room temperatures with comfort bounds">
                <div class="figure-caption">Outdoor vs indoor room temperatures with comfort bounds

        
        <h2 id="cop-models">5.1 COP Model Specification</h2>

        <div class="card">
            <h4>Model Overview</h4>
            <p>COP (Coefficient of Performance) is modeled as a linear function of outdoor temperature and
            HK2 target temperature (the heating curve setpoint):</p>
            <pre style="background: var(--card-bg); color: var(--text); padding: 0.5rem;">COP = β₀ + β_outdoor × T_outdoor + β_T_HK2 × T_HK2</pre>

            <h4>Best Model</h4>
            <p><strong>Stiebel outdoor + T_HK2</strong></p>
            <pre style="background: var(--card-bg); color: var(--text); padding: 0.5rem;">COP = 4.45 + 0.1184×T_outdoor + -0.0457×T_HK2</pre>
            <p>R² = 0.795, RMSE = 0.257</p>
        </div>

        <div class="card">
            <h4>Model Comparison</h4>
            <table>
                <tr>
                    <th>Model</th>
                    <th>R²</th>
                    <th>RMSE</th>
                    <th>β_outdoor</th>
                    <th>β_T_HK2</th>
                    <th>n</th>
                </tr>
                
                <tr>
                    <td>Stiebel outdoor only</td>
                    <td><strong>0.793</strong></td>
                    <td>0.259</td>
                    <td>0.1584</td>
                    <td>—</td>
                    <td>60</td>
                </tr>
                <tr>
                    <td>Davis outdoor only</td>
                    <td><strong>0.718</strong></td>
                    <td>0.296</td>
                    <td>0.1294</td>
                    <td>—</td>
                    <td>57</td>
                </tr>
                <tr style="background-color: #90EE90;">
                    <td>Stiebel outdoor + T_HK2</td>
                    <td><strong>0.795</strong></td>
                    <td>0.257</td>
                    <td>0.1184</td>
                    <td>-0.0457</td>
                    <td>60</td>
                </tr>
                <tr>
                    <td>Davis outdoor + T_HK2</td>
                    <td><strong>0.758</strong></td>
                    <td>0.274</td>
                    <td>0.0246</td>
                    <td>-0.1443</td>
                    <td>57</td>
                </tr>
            </table>
            <p><em>Green row = best model (highest R²)</em></p>
            
            <p><strong>Key finding:</strong> Adding T_HK2 (target flow temperature) improves the Stiebel model R² by
            0.003 (0.3% relative improvement).</p>
        </div>

        <div class="card">
            <h4>Interpretation</h4>
            <ul>
                <li><strong>β_outdoor (positive):</strong> Higher outdoor temperature → higher COP. Each +1°C outdoor
                temperature increases COP by approximately 0.118.</li>
                <li><strong>β_T_HK2 (negative):</strong> Higher target flow temperature → lower COP. Each +1°C in T_HK2
                decreases COP by approximately 0.046 (multivariate model).</li>
            </ul>
            <p>This confirms heat pump thermodynamics: efficiency decreases when the temperature lift
            (difference between evaporator and condenser) increases.</p>
        </div>

        <div class="card">
            <h4>Sensor Comparison</h4>
            <p>Two outdoor temperature sensors were compared:</p>
            <ul>
                <li><strong>Stiebel (heat pump sensor):</strong> Built into the heat pump unit, mounted near the house.
                This is what the heat pump uses internally for heating curve calculations.</li>
                <li><strong>Davis (weather station):</strong> External Davis weather station, mounted in a more exposed location.</li>
            </ul>
            <p>The Stiebel sensor generally provides better COP prediction (higher R²) because it measures the actual
            air temperature at the heat pump evaporator location, which directly affects heat pump performance.</p>
        </div>
    

        <h2 id="solar">6. Solar-Heating Correlation</h2>

        <div class="card">
            <h4>Heating Activity by Time of Day</h4>
            <table>
                <tr><td>Solar hours (8AM-5PM)</td><td>51.1% heating active</td></tr>
                <tr><td>Non-solar hours (5PM-8AM)</td><td>49.0% heating active</td></tr>
            </table>
        </div>

        
            
            <div class="figure">
                <img src="fig2.08_solar_heating_hourly.png" alt="Hourly PV generation, heating activity, and grid import profiles">
                <div class="figure-caption">Hourly PV generation, heating activity, and grid import profiles
            
            <div class="figure">
                <img src="fig2.09_battery_evening_heating.png" alt="Battery charging/discharging patterns and evening energy sources">
                <div class="figure-caption">Battery charging/discharging patterns and evening energy sources
            
            <div class="figure">
                <img src="fig2.10_forced_grid_heating.png" alt="Periods of grid-dependent heating when no PV is available">
                <div class="figure-caption">Periods of grid-dependent heating when no PV is available

        <h2 id="summary">7. Summary Statistics</h2>

        
            
            <div class="figure">
                <img src="fig2.11_summary_statistics.png" alt="Monthly breakdown, HDD analysis, consumption distribution, yearly totals">
                <div class="figure-caption">Monthly breakdown, HDD analysis, consumption distribution, yearly totals

        
        <h2 id="heating-curve">8. Heating Curve Analysis</h2>

        <div class="card">
            <h4>Model Overview</h4>
            <p>The target flow temperature for heating circuit 1 (HK1) follows a linear heating curve formula:</p>
            <pre style="background: var(--card-bg); color: var(--text); padding: 0.5rem;">T_target = T_setpoint + curve_rise × (T_ref - T_outdoor)</pre>

            <h4>Parameters</h4>
            <table>
                <tr><th>Parameter</th><th>Description</th><th>Value</th></tr>
                <tr>
                    <td><strong>T_setpoint</strong></td>
                    <td>Room temperature setpoint (comfort or eco depending on schedule)</td>
                    <td>Comfort: 20.3°C, Eco: 18.0°C</td>
                </tr>
                <tr>
                    <td><strong>curve_rise</strong></td>
                    <td>Heating curve slope (controllable parameter)</td>
                    <td>1.08 (range: 0.85 - 1.14)</td>
                </tr>
                <tr>
                    <td><strong>T_ref</strong></td>
                    <td>Internal reference temperature (derived from data)</td>
                    <td>Comfort: 21.34°C, Eco: 19.16°C</td>
                </tr>
                <tr>
                    <td><strong>T_outdoor</strong></td>
                    <td>Outdoor temperature sensor</td>
                    <td>Range: -3.8°C to 15.1°C</td>
                </tr>
            </table>
        </div>

        <div class="card">
            <h4>Schedule Regimes (Detected from Data)</h4>
            <p>The comfort/eco schedule was detected by analyzing step changes (>3°C) in the target temperature.
            The system automatically switches between comfort (higher setpoint) during the day and eco (lower setpoint) at night.</p>
            <table>
                <tr><th>Period</th><th>Comfort Start</th><th>Comfort End</th><th>Duration</th><th>Days</th></tr>
                <tr>
                    <td>2025-10-30 to 2025-12-26</td>
                    <td>06:30</td>
                    <td>20:00</td>
                    <td>13.5 hours</td>
                    <td>46</td>
                </tr>
                <tr>
                    <td>2025-12-27 to 2026-01-07</td>
                    <td>06:30</td>
                    <td>21:30</td>
                    <td>15.0 hours</td>
                    <td>10</td>
                </tr>
                <tr>
                    <td>2026-01-08 to 2026-01-08</td>
                    <td>06:30</td>
                    <td>09:00</td>
                    <td>2.5 hours</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>2026-01-09 to 2026-01-13</td>
                    <td>06:30</td>
                    <td>21:30</td>
                    <td>15.0 hours</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td>2026-01-16 to 2026-01-16</td>
                    <td>06:00</td>
                    <td>21:30</td>
                    <td>15.5 hours</td>
                    <td>1</td>
                </tr>

            </table>
            <p><em>Note: Times are in local timezone (Europe/Zurich). Comfort mode uses the higher setpoint;
            eco mode (outside comfort hours) uses the lower setpoint.</em></p>
        </div>

        <div class="card">
            <h4>Setpoint Regimes (Time-Varying Setpoints)</h4>
            <p>The comfort and eco temperature setpoints change over time. These changes affect the target flow temperature
            independently of the daily schedule. Notable: eco=30°C effectively disables eco mode (24h comfort).</p>
            <table>
                <tr><th>Start Date</th><th>Comfort (°C)</th><th>Eco (°C)</th><th>RMSE (°C)</th><th>Notes</th></tr>
                <tr>
                    <td>2025-10-28 17:25</td>
                    <td>20.5</td>
                    <td>nan</td>
                    <td>1.04</td>
                    <td></td>
                </tr>
                <tr>
                    <td>2025-10-28 17:25</td>
                    <td>20.5</td>
                    <td>18.7</td>
                    <td>1.04</td>
                    <td></td>
                </tr>
                <tr>
                    <td>2025-10-29 07:39</td>
                    <td>20.5</td>
                    <td>18.5</td>
                    <td>0.41</td>
                    <td></td>
                </tr>
                <tr>
                    <td>2025-10-29 10:35</td>
                    <td>20.5</td>
                    <td>18.3</td>
                    <td>0.69</td>
                    <td></td>
                </tr>
                <tr>
                    <td>2025-11-03 00:07</td>
                    <td>20.3</td>
                    <td>18.3</td>
                    <td>0.55</td>
                    <td></td>
                </tr>
                <tr>
                    <td>2025-11-04 15:09</td>
                    <td>20.2</td>
                    <td>18.3</td>
                    <td>0.50</td>
                    <td>Standard</td>
                </tr>
                <tr>
                    <td>2025-11-04 15:09</td>
                    <td>20.2</td>
                    <td>18.2</td>
                    <td>0.50</td>
                    <td>Standard</td>
                </tr>
                <tr>
                    <td>2025-11-25 23:55</td>
                    <td>20.2</td>
                    <td>18.0</td>
                    <td>0.50</td>
                    <td>Standard</td>
                </tr>
                <tr>
                    <td>2025-12-04 15:48</td>
                    <td>20.2</td>
                    <td>30.0</td>
                    <td>5.09</td>
                    <td>Eco disabled (24h comfort)</td>
                </tr>
                <tr>
                    <td>2025-12-07 09:59</td>
                    <td>20.2</td>
                    <td>18.0</td>
                    <td>0.36</td>
                    <td>Standard</td>
                </tr>
                <tr>
                    <td>2025-12-14 10:23</td>
                    <td>20.5</td>
                    <td>18.0</td>
                    <td>0.60</td>
                    <td></td>
                </tr>
                <tr>
                    <td>2025-12-25 14:25</td>
                    <td>20.7</td>
                    <td>18.0</td>
                    <td>0.78</td>
                    <td></td>
                </tr>
                <tr>
                    <td>2025-12-27 10:29</td>
                    <td>21.0</td>
                    <td>18.0</td>
                    <td>0.66</td>
                    <td>Higher comfort</td>
                </tr>
                <tr>
                    <td>2025-12-30 22:22</td>
                    <td>20.7</td>
                    <td>18.0</td>
                    <td>1.10</td>
                    <td></td>
                </tr>
                <tr>
                    <td>2025-12-31 10:27</td>
                    <td>21.0</td>
                    <td>18.0</td>
                    <td>1.55</td>
                    <td>Higher comfort</td>
                </tr>
                <tr>
                    <td>2026-01-12 10:01</td>
                    <td>23.0</td>
                    <td>18.0</td>
                    <td>2.32</td>
                    <td>Higher comfort</td>
                </tr>
                <tr>
                    <td>2026-01-12 10:01</td>
                    <td>23.0</td>
                    <td>15.0</td>
                    <td>2.32</td>
                    <td>Higher comfort</td>
                </tr>
                <tr>
                    <td>2026-01-13 23:05</td>
                    <td>23.0</td>
                    <td>14.0</td>
                    <td>3.78</td>
                    <td>Higher comfort</td>
                </tr>
                <tr>
                    <td>2026-01-13 23:21</td>
                    <td>21.0</td>
                    <td>14.0</td>
                    <td>3.78</td>
                    <td>Higher comfort</td>
                </tr>
                <tr>
                    <td>2026-01-17 12:21</td>
                    <td>20.5</td>
                    <td>14.0</td>
                    <td>2.03</td>
                    <td></td>
                </tr>
                <tr>
                    <td>2026-01-17 12:21</td>
                    <td>20.5</td>
                    <td>17.0</td>
                    <td>2.03</td>
                    <td></td>
                </tr>

            </table>
        </div>

        <div class="card">
            <h4>Model Performance</h4>
            <table>
                <tr><td>R-squared</td><td><strong>0.9207</strong> (explains 92.1% of variance)</td></tr>
                <tr><td>RMSE (overall)</td><td>1.28°C</td></tr>
                <tr><td>RMSE (comfort mode)</td><td>0.52°C</td></tr>
                <tr><td>RMSE (eco mode)</td><td>1.45°C</td></tr>
            </table>

            <h4>Parameter Effects</h4>
            <ul>
                <li><strong>Setpoint</strong>: +1°C setpoint → +1°C target flow temperature (direct relationship)</li>
                <li><strong>Curve rise</strong>: +0.1 rise → +1.6°C target at 5°C outdoor, +2.1°C at 0°C outdoor</li>
                <li><strong>Outdoor temperature</strong>: +1°C outdoor → -1.08°C target (inverse relationship via curve)</li>
            </ul>
        </div>

        <div class="card">
            <h4>Example Calculations</h4>
            <p>For outdoor temperature = 5°C, comfort_temp = 20.3°C, eco_temp = 18.0°C, curve_rise = 1.08:</p>
            <table>
                <tr><th>Outdoor</th><th>Comfort Target</th><th>Eco Target</th></tr>
                <tr><td>-3°C</td><td>46.6°C</td><td>41.9°C</td></tr>
                <tr><td>0°C</td><td>43.3°C</td><td>38.7°C</td></tr>
                <tr><td>5°C</td><td>37.9°C</td><td>33.3°C</td></tr>
                <tr><td>10°C</td><td>32.5°C</td><td>27.9°C</td></tr>
                <tr><td>15°C</td><td>27.1°C</td><td>22.5°C</td></tr>
            </table>
        </div>

        <div class="figure">
            <img src="fig2.12_heating_curve_schedule.png" alt="Heating curve analysis with schedule detection">
            <div class="figure-caption">Fig 12: Heating curve analysis (all data): setpoint regimes (top-left), target vs outdoor temperature colored by setpoint (top-right),
            model residuals by hour (bottom-left), and model summary (bottom-right)</div>
        </div>

        <div class="figure">
            <img src="fig2.12a_heating_curve_censored.png" alt="Heating curve analysis excluding anomalous periods">
            <div class="figure-caption">Fig 12a: Heating curve analysis (censored): excluding anomalous periods where eco >= comfort.
            Shows residual distribution (top-left), target vs outdoor (top-right), predicted vs actual (bottom-left), and summary stats (bottom-right).
            R² = 0.9460, RMSE = 1.02°C for normal operation.</div>
        </div>


        
        <h2 id="weighted-temp">9. Weighted Indoor Temperature Analysis</h2>

        <div class="card">
            <h4>Overview</h4>
            <p>The <strong>indoor temperature (T_weighted)</strong> is the primary comfort objective
            for the Phase 5 intervention study. It uses the davis_inside sensor as the single
            reference temperature (least noise, central location).</p>

            <h4>Temperature Sensor</h4>
            <pre style="background: var(--card-bg); color: var(--text); padding: 0.5rem;">T_weighted = davis_inside_temperature</pre>

            <table>
                <tr><th>Sensor</th><th>Weight</th><th>Rationale</th></tr>
                <tr><td>davis_inside_temperature</td><td>100%</td><td>Primary living area, central location, least noise</td></tr>
            </table>
        </div>

        <div class="card">
            <h4>Analysis Period Summary</h4>
            <table>
                <tr><td>Total readings</td><td>4,578</td></tr>
                <tr><td>Washout periods (48h after parameter changes)</td><td>1,681 (36.7%)</td></tr>
                <tr><td>Analysis readings (excluding washout)</td><td>2,897 (63.3%)</td></tr>
            </table>

            <h4>Temperature Statistics (Excluding Washout)</h4>
            <table>
                <tr><td>Mean T_weighted</td><td><strong>18.9°C</strong></td></tr>
                <tr><td>Std deviation</td><td>0.9°C</td></tr>
                <tr><td>Range</td><td>16.3°C to 21.1°C</td></tr>
                <tr><td>Comfort compliance (08:00-22:00, 18.5-22°C)</td><td><strong>81.8%</strong></td></tr>
            </table>
        </div>

        <div class="card">
            <h4>Multivariate Regression Model</h4>
            <p>A multivariate model predicts T_weighted (during occupied hours) from all controllable parameters simultaneously,
            using daily aggregates to capture parameter effects while controlling for confounding variables.</p>

            <p><strong>Model Performance:</strong> R² = 0.567, Adjusted R² = 0.527, RMSE = 0.51°C, n = 61 days</p>
            <table>
                <tr><th>Parameter</th><th>Coefficient</th><th>Std Error</th><th>t-stat</th><th>p-value</th><th>Interpretation</th></tr>
                <tr>
                    <td>Intercept</td>
                    <td><strong>-15.789</strong></td>
                    <td>7.784</td>
                    <td>-2.03</td>
                    <td>0.0474 *</td>
                    <td>Baseline: -15.8°C</td>
                </tr>
                <tr>
                    <td>Comfort Setpoint</td>
                    <td><strong>1.225</strong></td>
                    <td>0.318</td>
                    <td>3.85</td>
                    <td>0.0003 ***</td>
                    <td>+1°C setpoint → +1.22°C T_weighted</td>
                </tr>
                <tr>
                    <td>Eco Setpoint</td>
                    <td><strong>-0.061</strong></td>
                    <td>0.032</td>
                    <td>-1.89</td>
                    <td>0.0637 </td>
                    <td>+1°C setpoint → -0.06°C T_weighted</td>
                </tr>
                <tr>
                    <td>Curve Rise</td>
                    <td><strong>9.627</strong></td>
                    <td>1.632</td>
                    <td>5.90</td>
                    <td>0.0000 ***</td>
                    <td>+0.1 curve → +0.96°C T_weighted</td>
                </tr>
                <tr>
                    <td>Comfort Hours</td>
                    <td><strong>0.035</strong></td>
                    <td>0.031</td>
                    <td>1.12</td>
                    <td>0.2674 </td>
                    <td>+1h comfort → +0.03°C T_weighted</td>
                </tr>
                <tr>
                    <td>Outdoor Temp</td>
                    <td><strong>0.079</strong></td>
                    <td>0.022</td>
                    <td>3.65</td>
                    <td>0.0006 ***</td>
                    <td>+1°C outdoor → +0.08°C T_weighted</td>
                </tr>
            </table>
            <p><em>Significance: *** p&lt;0.001, ** p&lt;0.01, * p&lt;0.05</em></p>
        </div>

        <div class="card">
            <h4>Washout Period Rationale</h4>
            <p>A <strong>48-hour (2-day) washout period</strong> is applied after each parameter change to allow
            the thermal system to reach equilibrium. This is based on:</p>
            <ul>
                <li>Building thermal time constant: ~19 hours (weighted average from Phase 3 thermal model)</li>
                <li>Washout = 2.5× time constant ≈ 48 hours (~87% equilibrium)</li>
                <li>Conservative approach to ensure clean measurements in Phase 5 intervention study</li>
            </ul>
            <p><em>Note: Phase 5 study design uses 3-day (72h) washout for additional safety margin.</em></p>
        </div>

        <div class="card">
            <h4>Parameter Regimes Detected</h4>
            <table>
                <tr><th>Start Date</th><th>Comfort (°C)</th><th>Eco (°C)</th><th>Curve Rise</th><th>Mean T_weighted (°C)</th><th>N Readings</th></tr>
                <tr>
                    <td>2025-10-29</td>
                    <td>20.5</td>
                    <td>18.3</td>
                    <td>1.14</td>
                    <td>20.3</td>
                    <td>122</td>
                </tr>
                <tr>
                    <td>2025-11-04</td>
                    <td>20.2</td>
                    <td>18.2</td>
                    <td>1.11</td>
                    <td>19.8</td>
                    <td>677</td>
                </tr>
                <tr>
                    <td>2025-11-19</td>
                    <td>20.2</td>
                    <td>18.2</td>
                    <td>1.07</td>
                    <td>18.4</td>
                    <td>243</td>
                </tr>
                <tr>
                    <td>2025-11-25</td>
                    <td>20.2</td>
                    <td>18.0</td>
                    <td>1.08</td>
                    <td>18.5</td>
                    <td>341</td>
                </tr>
                <tr>
                    <td>2025-12-04</td>
                    <td>20.2</td>
                    <td>30.0</td>
                    <td>1.08</td>
                    <td>18.1</td>
                    <td>40</td>
                </tr>
                <tr>
                    <td>2025-12-07</td>
                    <td>20.2</td>
                    <td>18.0</td>
                    <td>1.08</td>
                    <td>18.9</td>
                    <td>268</td>
                </tr>
                <tr>
                    <td>2025-12-14</td>
                    <td>20.5</td>
                    <td>18.0</td>
                    <td>1.08</td>
                    <td>18.8</td>
                    <td>502</td>
                </tr>
                <tr>
                    <td>2025-12-27</td>
                    <td>21.0</td>
                    <td>18.0</td>
                    <td>1.10</td>
                    <td>19.5</td>
                    <td>91</td>
                </tr>
                <tr>
                    <td>2026-01-01</td>
                    <td>21.0</td>
                    <td>18.0</td>
                    <td>0.97</td>
                    <td>18.4</td>
                    <td>505</td>
                </tr>
                <tr>
                    <td>2026-01-13</td>
                    <td>21.0</td>
                    <td>14.0</td>
                    <td>0.85</td>
                    <td>17.6</td>
                    <td>107</td>
                </tr>
            </table>
        </div>

        <div class="card">
            <h4>Occupied vs Night Hours Comparison</h4>
            <p><strong>Important:</strong> Comfort compliance is evaluated only during <strong>occupied hours (08:00-22:00)</strong>.
            Night temperatures (22:00-08:00) are excluded from the comfort objective, allowing energy-saving setback without penalty.</p>
            <table>
                <tr><th>Metric</th><th>Occupied (08:00-22:00)</th><th>Night (22:00-08:00)</th></tr>
                <tr><td>Mean T_weighted</td><td><strong>19.2°C</strong></td><td>18.4°C</td></tr>
                <tr><td>Minimum T_weighted</td><td>17.3°C</td><td>16.3°C</td></tr>
                <tr><td>Below 18.5°C</td><td>18.2%</td><td>—</td></tr>
                <tr><td>Below 18.0°C</td><td>—</td><td>31.5%</td></tr>
                <tr><td>Comfort compliance (18.5-22°C)</td><td><strong>81.8%</strong></td><td>Not evaluated</td></tr>
                <tr><td>N readings</td><td>1,762</td><td>1,135</td></tr>
            </table>
            <p><em>This explains why the overall mean (18.7°C) appears low - night temperatures bring down the average,
            but comfort compliance during occupied hours (81.8%) is what matters for the intervention study.</em></p>
        </div>

        <div class="figure">
            <img src="fig2.13_weighted_temp_parameters.png" alt="Weighted temperature parameter analysis">
            <div class="figure-caption">Fig 13: Weighted indoor temperature analysis (6 panels).
            <strong>Top row:</strong> Full time series with washout periods and regime changes (left),
            multivariate model coefficients with 95% CI (right).
            <strong>Middle row:</strong> Model validation - predicted vs actual T_weighted (left),
            partial effects showing setpoint impact on T_weighted (right).
            <strong>Bottom row:</strong> T_weighted during OCCUPIED hours (08:00-22:00) with comfort bounds (left),
            T_weighted during NIGHT hours (22:00-08:00) for reference (right).
            Orange dashed lines indicate parameter changes, red shading indicates 48h washout periods.</div>
        </div>


        
    <h2 id="tariffs">10. Electricity Tariffs</h2>

    <div class="card">
        <h4>Data Source Note</h4>
        <p><strong>Important:</strong> Only feed-in tariffs <em>with HKN</em> (Herkunftsnachweis) are shown.
        Base-only feed-in rates are excluded because this installation participates in the HKN program,
        receiving the additional HKN bonus (1.5-4.5 Rp/kWh) on top of the base rate.</p>
    </div>

    <div class="grid">
        <div class="stat-box">
            <div class="value">21.5</div>
            <div class="label">Rp/kWh Peak Feed-in (HKN)</div>
        </div>
        <div class="stat-box">
            <div class="value">13.0</div>
            <div class="label">Rp/kWh Current Feed-in (HKN)</div>
        </div>
        <div class="stat-box">
            <div class="value">40%</div>
            <div class="label">Feed-in Rate Decline</div>
        </div>
        <div class="stat-box">
            <div class="value">47%</div>
            <div class="label">High Tariff Hours</div>
        </div>
    </div>

    <h3>Tariff Time Windows</h3>
    <div class="card">
        <table>
            <tr><th>Tariff</th><th>Time Windows</th><th>Hours</th></tr>
            <tr>
                <td><strong>High Tariff</strong> (Hochtarif)</td>
                <td>Mon-Fri 06:00-21:00, Sat 06:00-12:00</td>
                <td>12,702 (47.0%)</td>
            </tr>
            <tr>
                <td><strong>Low Tariff</strong> (Niedertarif)</td>
                <td>Mon-Fri 21:00-06:00, Sat 12:00-Mon 06:00, Holidays</td>
                <td>14,323 (53.0%)</td>
            </tr>
        </table>
    </div>

    <h3>Purchase Tariffs (Grid Import)</h3>
    <div class="card">
        <table border="1" class="dataframe data-table">
  <thead>
    <tr style="text-align: right;">
      <th>period</th>
      <th>rate_type</th>
      <th>rate_rp_kwh</th>
      <th>notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>2023-01-01 to 2023-12-31</td>
      <td>high</td>
      <td>34.4</td>
      <td>Average increase of 10 Rp/kWh vs 2022. 4500kWh household: CHF 1410/year (was CHF 965). HT/NT estimates based on typical Swiss utility spreads (~+10% HT / -15% NT vs average).</td>
    </tr>
    <tr>
      <td>2023-01-01 to 2023-12-31</td>
      <td>low</td>
      <td>26.6</td>
      <td>Average increase of 10 Rp/kWh vs 2022. 4500kWh household: CHF 1410/year (was CHF 965). HT/NT estimates based on typical Swiss utility spreads (~+10% HT / -15% NT vs average).</td>
    </tr>
    <tr>
      <td>2023-01-01 to 2023-12-31</td>
      <td>average_estimate</td>
      <td>31.3</td>
      <td>Calculated from CHF 1410 / 4500 kWh = 31.3 Rp/kWh</td>
    </tr>
    <tr>
      <td>2024-01-01 to 2024-12-31</td>
      <td>high</td>
      <td>36.1</td>
      <td>Primeo Standard single tariff confirmed at 16.50 Rp/kWh. 4500kWh household: CHF 1475/year (+4.8%). HT/NT estimates based on typical Swiss utility spreads (~+10% HT / -15% NT vs average).</td>
    </tr>
    <tr>
      <td>2024-01-01 to 2024-12-31</td>
      <td>low</td>
      <td>27.9</td>
      <td>Primeo Standard single tariff confirmed at 16.50 Rp/kWh. 4500kWh household: CHF 1475/year (+4.8%). HT/NT estimates based on typical Swiss utility spreads (~+10% HT / -15% NT vs average).</td>
    </tr>
    <tr>
      <td>2024-01-01 to 2024-12-31</td>
      <td>average_estimate</td>
      <td>32.8</td>
      <td>Calculated from CHF 1475 / 4500 kWh = 32.8 Rp/kWh</td>
    </tr>
    <tr>
      <td>2025-01-01 to 2025-12-31</td>
      <td>high</td>
      <td>35.9</td>
      <td>1% decrease vs 2024. 4500kWh household: ~CHF 1465/year (-CHF 10). HT/NT estimates based on typical Swiss utility spreads (~+10% HT / -15% NT vs average).</td>
    </tr>
    <tr>
      <td>2025-01-01 to 2025-12-31</td>
      <td>low</td>
      <td>27.7</td>
      <td>1% decrease vs 2024. 4500kWh household: ~CHF 1465/year (-CHF 10). HT/NT estimates based on typical Swiss utility spreads (~+10% HT / -15% NT vs average).</td>
    </tr>
    <tr>
      <td>2025-01-01 to 2025-12-31</td>
      <td>average_estimate</td>
      <td>32.6</td>
      <td>Calculated from CHF 1465 / 4500 kWh = 32.6 Rp/kWh</td>
    </tr>
  </tbody>
</table>
    </div>

    <h3>Feed-in Tariffs (Grid Export) - With HKN Only</h3>
    <div class="card">
        <table border="1" class="dataframe data-table">
  <thead>
    <tr style="text-align: right;">
      <th>period</th>
      <th>rate_type</th>
      <th>rate_rp_kwh</th>
      <th>notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>2023-01-01 to 2023-06-30</td>
      <td>total_standard</td>
      <td>21.5</td>
      <td>Base + HKN standard. Peak rate after 2022 energy crisis</td>
    </tr>
    <tr>
      <td>2023-07-01 to 2023-12-31</td>
      <td>total_standard</td>
      <td>17.5</td>
      <td>Base + HKN standard. Reduced from 20 Rp/kWh due to lower market prices</td>
    </tr>
    <tr>
      <td>2023-07-01 to 2023-12-31</td>
      <td>minimum_guarantee</td>
      <td>9.0</td>
      <td>Guaranteed until 2028-12-31</td>
    </tr>
    <tr>
      <td>2024-01-01 to 2024-06-30</td>
      <td>total_standard</td>
      <td>17.5</td>
      <td>Base + HKN standard. Unchanged from H2 2023</td>
    </tr>
    <tr>
      <td>2024-01-01 to 2024-06-30</td>
      <td>minimum_guarantee</td>
      <td>9.0</td>
      <td>Guaranteed until 2028-12-31</td>
    </tr>
    <tr>
      <td>2024-07-01 to 2024-12-31</td>
      <td>total_standard</td>
      <td>14.5</td>
      <td>Base + HKN standard. Reduced from 16 Rp/kWh, -20% cut announced</td>
    </tr>
    <tr>
      <td>2024-07-01 to 2024-12-31</td>
      <td>minimum_guarantee</td>
      <td>9.0</td>
      <td>Guaranteed until 2028-12-31</td>
    </tr>
    <tr>
      <td>2025-01-01 to 2025-03-31</td>
      <td>total_standard</td>
      <td>15.5</td>
      <td>Base + HKN standard. HKN increased to 2.5 Rp/kWh</td>
    </tr>
    <tr>
      <td>2025-01-01 to 2025-03-31</td>
      <td>minimum_guarantee</td>
      <td>9.0</td>
      <td>Guaranteed until 2028-12-31</td>
    </tr>
    <tr>
      <td>2025-04-01 to 2025-12-31</td>
      <td>total_standard</td>
      <td>13.0</td>
      <td>Base + HKN standard. Reduced from 13 Rp/kWh to 10.5 Rp/kWh as of April 2025</td>
    </tr>
    <tr>
      <td>2025-04-01 to 2025-12-31</td>
      <td>minimum_guarantee</td>
      <td>9.0</td>
      <td>Guaranteed until 2028-12-31</td>
    </tr>
  </tbody>
</table>
        <p class="note" style="margin-top: 1rem; font-size: 0.85rem; color: #64748b;">
        HKN = Herkunftsnachweis (certificate of origin). Minimum guarantee of 9 Rp/kWh applies through 2028.
        </p>
    </div>

    <h3>Key Insights</h3>
    <div class="card">
        <ul>
            <li><strong>Feed-in rate decline:</strong> From 21.5 Rp/kWh (Jan 2023) to 13.0 Rp/kWh (Apr 2025) - a 40% reduction</li>
            <li><strong>Minimum guarantee:</strong> 9 Rp/kWh floor until 2028 provides investment security</li>
            <li><strong>Grid import cost:</strong> ~32-33 Rp/kWh (2024-2025), roughly 2.5x the current feed-in rate</li>
            <li><strong>Self-consumption value:</strong> Avoiding grid import saves ~20 Rp/kWh more than feeding in</li>
            <li><strong>Low tariff opportunity:</strong> 53% of hours are low-tariff - shifting consumption here reduces costs</li>
        </ul>
    </div>

    <h3>Tariff Timeline</h3>
    <div class="figure">
        <img src="fig2.14_tariff_timeline.png" alt="Tariff Timeline" style="max-width: 100%;">
        <p class="caption"><strong>Figure 14:</strong> Purchase and feed-in tariff rates over time (2023-2025).
        Solid lines show grid import rates (high/low), dashed lines show feed-in rates with HKN (excluding base-only rates).</p>
    </div>

    <h3>Tariff Time Windows Distribution</h3>
    <div class="figure">
        <img src="fig2.15_tariff_windows.png" alt="Tariff Windows" style="max-width: 100%;">
        <p class="caption"><strong>Figure 15:</strong> Distribution of high/low tariff periods.
        Shows weekly heatmap, hourly probability, monthly distribution, and summary statistics.</p>
    </div>
    <div class="card">
        <p><strong>Note on "High Tariff Probability":</strong> The heatmap shows the fraction of times each
        day/hour combination is high tariff across the dataset. Since the tariff schedule is deterministic
        (Mon-Fri 06:00-21:00, Sat 06:00-12:00 = high tariff), most cells are 0 or 1. However, <em>federal holidays</em>
        (Jan 1, Good Friday, Easter, Ascension, Whit Monday, Aug 1, Dec 25) are low tariff all day regardless
        of the day of week. This causes weekday daytime probabilities to be slightly below 1.0 (~0.97),
        reflecting the occasional holiday override.</p>
    </div>

    <h3>Cost Comparison</h3>
    <div class="figure">
        <img src="fig2.16_tariff_costs.png" alt="Tariff Costs" style="max-width: 100%;">
        <p class="caption"><strong>Figure 16:</strong> Tariff rate comparison showing feed-in trend (left)
        and rate comparison across different scenarios (right). Self-consumption value = import rate - feed-in rate.</p>
    </div>
    

        
    <section id="hk2-target-actual">
    <h2>2.7 HK2 Target vs Actual Temperature Analysis</h2>

    <h3>Overview</h3>
    <p>This analysis examines the relationship between the HK2 <strong>target</strong> temperature
    (heating curve setpoint, controllable) and <strong>actual</strong> temperature (measured flow).
    Understanding this relationship is critical because:</p>
    <ul>
        <li>The thermal model uses actual HK2 as the heating input signal</li>
        <li>Optimization controls target HK2 via setpoint and curve_rise parameters</li>
        <li>A gap between target and actual affects model predictions</li>
    </ul>

    <h3>Deviation Statistics</h3>
    <p>Analysis of the difference: $\Delta T = T_{actual} - T_{target}$</p>
    <table>
        <tr><th>Statistic</th><th>Value</th></tr>
        <tr><td>Number of observations</td><td>6,542</td></tr>
        <tr><td>Mean deviation ($\bar{\Delta T}$)</td><td><strong>-1.42°C</strong></td></tr>
        <tr><td>Std deviation ($\sigma_{\Delta T}$)</td><td>1.85°C</td></tr>
        <tr><td>Min deviation</td><td>-14.2°C</td></tr>
        <tr><td>Max deviation</td><td>29.1°C</td></tr>
        <tr><td>Actual above target</td><td>15.2%</td></tr>
        <tr><td>Within ±1°C</td><td>52.2%</td></tr>
        <tr><td>Within ±2°C</td><td>69.8%</td></tr>
        <tr><td>Correlation ($r$)</td><td>0.913</td></tr>
    </table>

    <h3>First-Order Lag Model</h3>
    <p>We fit a first-order lag model to characterize the dynamics:</p>
    <div class="equation-box">
    $$T_{actual}[k+1] = T_{actual}[k] + \frac{\Delta t}{\tau} \left( T_{target}[k] - T_{actual}[k] \right)$$
    </div>
    <p>where $\tau$ is the time constant (how quickly actual approaches target).</p>

    <table>
        <tr><th>Model Parameter</th><th>Value</th></tr>
        <tr><td>Time constant ($\tau$)</td><td><strong>0.37 hours</strong></td></tr>
        <tr><td>Forward simulation $R^2$</td><td>0.748</td></tr>
        <tr><td>Forward simulation RMSE</td><td>2.24°C</td></tr>
        <tr><td>One-step prediction $R^2$</td><td>0.842</td></tr>
        <tr><td>One-step prediction RMSE</td><td>1.77°C</td></tr>
    </table>

    <p><strong>Interpretation:</strong> A time constant of τ = 0.4 hours means the actual
    temperature reaches ~63% of a step change in target within 0.4 hours, and ~95% within
    1.1 hours (3τ).</p>

    <h3>Cross-Correlation Analysis</h3>
    <table>
        <tr><th>Metric</th><th>Value</th></tr>
        <tr><td>Peak correlation</td><td>0.920</td></tr>
        <tr><td>Peak lag</td><td>-0.25 hours</td></tr>
        <tr><td>Zero-lag correlation</td><td>0.913</td></tr>
    </table>

    
        <div class="warning">
        <strong>Recommendation:</strong> The lag model achieves moderate fit (R² = 0.748).
        Consider using actual HK2 temperature directly in thermal models rather than predicting
        from target. The dynamics may involve factors beyond simple first-order lag.
        </div>
        

    <h3>Implications for Thermal Modeling</h3>
    <ul>
        <li><strong>Transfer function model:</strong> Currently uses actual HK2 ($T_{actual}$) as input.
            This is appropriate since it reflects real heat delivery.</li>
        <li><strong>Grey-box model:</strong> Uses target HK2 ($T_{target}$) as input.
            The mismatch between target and actual may explain forward simulation divergence.</li>
        <li><strong>Optimization:</strong> Changes to setpoint/curve_rise affect target immediately
            but take ~0 hours to fully propagate to actual flow temperature.</li>
    </ul>

    <figure>
        <img src="fig2.17_hk2_target_actual.png" alt="HK2 Target vs Actual Analysis">
        <figcaption><strong>Figure 17:</strong> HK2 target vs actual temperature analysis:
        time series (top-left), scatter correlation (top-right), deviation distribution (bottom-left),
        lag model fit (bottom-right).</figcaption>
    </figure>
    </section>
    

        
    <h2 id="sensor-exploration">12. Sensor Exploration Analysis</h2>

    <div class="card">
        <h4>Purpose</h4>
        <p>This analysis systematically evaluates all ~190 sensors in the integrated dataset to identify
        candidates that could improve thermal and COP models. The goal is to find sensors that:</p>
        <ul>
            <li><strong>Correlate with model residuals:</strong> Capture dynamics the current models miss</li>
            <li><strong>Correlate with COP:</strong> Help explain heat pump efficiency variations</li>
            <li><strong>Have good data coverage:</strong> Available during the heating analysis period</li>
        </ul>
    </div>

    <div class="card">
        <h4>Summary Statistics</h4>
        <table>
            <tr><td><strong>Total sensors analyzed</strong></td><td>198</td></tr>
            <tr><td><strong>High coverage (>80%)</strong></td><td>8 sensors</td></tr>
            <tr><td><strong>Medium coverage (50-80%)</strong></td><td>0 sensors</td></tr>
            <tr><td><strong>Low coverage (<50%)</strong></td><td>190 sensors</td></tr>
            <tr><td><strong>Focus sensors with data</strong></td><td>13 of 13</td></tr>
        </table>
    </div>

    <div class="card">
        <h4>Coverage by Sensor Category</h4>
        <p>Different sensor categories have varying data availability based on when they were added to the monitoring system:</p>
        <table>
            <tr><th>Category</th><th>Sensors</th><th>Mean Coverage</th><th>Notes</th></tr>
            <tr><td>energy</td><td>43</td><td>2.4%</td><td>Partial period</td></tr><tr><td>heating</td><td>96</td><td>2.3%</td><td>Heat pump sensors (Oct 2025+)</td></tr><tr><td>other</td><td>8</td><td>99.9%</td><td>Full period available</td></tr><tr><td>rooms</td><td>26</td><td>2.9%</td><td>Partial period</td></tr><tr><td>weather</td><td>25</td><td>3.4%</td><td>Partial period</td></tr>
        </table>
    </div>

    <div class="card">
        <h4>Focus Sensors Analysis</h4>
        <p>These sensors were pre-identified as high-potential for model improvement based on physical understanding:</p>
        <ul>
            <li><strong>Pressure sensors</strong> (high_pressure_wp1, low_pressure_wp1): Enable thermodynamic COP calculation via Carnot efficiency</li>
            <li><strong>Hot gas temperature</strong>: Indicates superheat and compressor efficiency</li>
            <li><strong>Wind sensors</strong>: Could capture infiltration losses affecting thermal model</li>
            <li><strong>Defrost indicator</strong>: Allows filtering periods when COP is artificially low due to defrost cycles</li>
        </ul>
        <table border="1" class="dataframe compact">
  <thead>
    <tr style="text-align: right;">
      <th>sensor</th>
      <th>coverage_pct</th>
      <th>room_corr</th>
      <th>residual_corr</th>
      <th>cop_corr</th>
      <th>combined_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>low_pressure_wp1</td>
      <td>7.744</td>
      <td>0.383</td>
      <td>0.022</td>
      <td>0.961</td>
      <td>0.585</td>
    </tr>
    <tr>
      <td>hot_gas_temperature_wp1</td>
      <td>7.745</td>
      <td>-0.120</td>
      <td>-0.026</td>
      <td>-0.927</td>
      <td>0.567</td>
    </tr>
    <tr>
      <td>flow_temperature_wp1</td>
      <td>7.725</td>
      <td>-0.034</td>
      <td>-0.020</td>
      <td>-0.847</td>
      <td>0.514</td>
    </tr>
    <tr>
      <td>return_temperature_wp1</td>
      <td>7.696</td>
      <td>0.012</td>
      <td>-0.002</td>
      <td>-0.793</td>
      <td>0.470</td>
    </tr>
    <tr>
      <td>high_pressure_wp1</td>
      <td>7.745</td>
      <td>0.024</td>
      <td>-0.022</td>
      <td>-0.766</td>
      <td>0.468</td>
    </tr>
    <tr>
      <td>volume_stream_wp1</td>
      <td>4.097</td>
      <td>-0.085</td>
      <td>-0.040</td>
      <td>-0.516</td>
      <td>0.175</td>
    </tr>
    <tr>
      <td>barometer</td>
      <td>7.744</td>
      <td>-0.032</td>
      <td>-0.040</td>
      <td>-0.214</td>
      <td>0.151</td>
    </tr>
    <tr>
      <td>2_min_avg_wind_speed</td>
      <td>6.873</td>
      <td>-0.067</td>
      <td>-0.090</td>
      <td>-0.119</td>
      <td>0.110</td>
    </tr>
    <tr>
      <td>outside_humidity</td>
      <td>4.521</td>
      <td>-0.344</td>
      <td>-0.262</td>
      <td>0.049</td>
      <td>0.108</td>
    </tr>
    <tr>
      <td>wind_speed</td>
      <td>6.907</td>
      <td>-0.060</td>
      <td>-0.088</td>
      <td>-0.114</td>
      <td>0.107</td>
    </tr>
    <tr>
      <td>evaporator_defrost</td>
      <td>0.356</td>
      <td>-0.121</td>
      <td>-0.037</td>
      <td>-0.575</td>
      <td>0.037</td>
    </tr>
    <tr>
      <td>is_heating</td>
      <td>1.348</td>
      <td>-0.082</td>
      <td>-0.040</td>
      <td>-0.154</td>
      <td>0.020</td>
    </tr>
    <tr>
      <td>compressor</td>
      <td>1.363</td>
      <td>-0.080</td>
      <td>-0.029</td>
      <td>-0.157</td>
      <td>0.020</td>
    </tr>
  </tbody>
</table>
        <p><em>Coverage = percentage of 15-minute intervals with valid data. Correlations are Pearson r values.</em></p>
    </div>

    <div class="card">
        <h4>Top Sensors for Thermal Model Improvement</h4>
        <p>Sensors with highest absolute correlation to thermal model residuals. High correlation means the sensor
        captures dynamics that the current transfer-function model misses:</p>
        <table border="1" class="dataframe compact">
  <thead>
    <tr style="text-align: right;">
      <th>sensor</th>
      <th>category</th>
      <th>coverage_pct</th>
      <th>residual_corr</th>
      <th>thermal_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>stiebel_eltron_isg_low_pressure_wp1</td>
      <td>heating</td>
      <td>7.744</td>
      <td>0.022</td>
      <td>0.022</td>
    </tr>
    <tr>
      <td>stiebel_eltron_isg_hot_gas_temperature_wp1</td>
      <td>heating</td>
      <td>7.745</td>
      <td>-0.026</td>
      <td>0.026</td>
    </tr>
    <tr>
      <td>total_consumption_kwh</td>
      <td>other</td>
      <td>99.643</td>
      <td>0.160</td>
      <td>0.159</td>
    </tr>
    <tr>
      <td>stiebel_eltron_isg_flow_temperature_wp1</td>
      <td>heating</td>
      <td>7.725</td>
      <td>-0.020</td>
      <td>0.019</td>
    </tr>
    <tr>
      <td>stiebel_eltron_isg_actual_temperature_hk_2</td>
      <td>heating</td>
      <td>7.694</td>
      <td>0.031</td>
      <td>0.031</td>
    </tr>
    <tr>
      <td>stiebel_eltron_isg_return_temperature_wp1</td>
      <td>heating</td>
      <td>7.696</td>
      <td>-0.002</td>
      <td>0.002</td>
    </tr>
    <tr>
      <td>stiebel_eltron_isg_high_pressure_wp1</td>
      <td>heating</td>
      <td>7.745</td>
      <td>-0.022</td>
      <td>0.022</td>
    </tr>
    <tr>
      <td>wp_anlage_hk2_ist</td>
      <td>heating</td>
      <td>7.571</td>
      <td>0.036</td>
      <td>0.034</td>
    </tr>
    <tr>
      <td>external_supply_kwh</td>
      <td>other</td>
      <td>99.969</td>
      <td>0.085</td>
      <td>0.085</td>
    </tr>
    <tr>
      <td>wp_wp_vorlauf</td>
      <td>heating</td>
      <td>7.708</td>
      <td>-0.017</td>
      <td>0.016</td>
    </tr>
  </tbody>
</table>
        <p><em>Thermal score = |residual_corr| × coverage_weight. Higher is better.</em></p>
    </div>

    <div class="card">
        <h4>Top Sensors for COP Model Improvement</h4>
        <p>Sensors with highest absolute correlation to daily COP. These could improve heat pump efficiency predictions:</p>
        <table border="1" class="dataframe compact">
  <thead>
    <tr style="text-align: right;">
      <th>sensor</th>
      <th>category</th>
      <th>coverage_pct</th>
      <th>cop_corr</th>
      <th>cop_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>stiebel_eltron_isg_low_pressure_wp1</td>
      <td>heating</td>
      <td>7.744</td>
      <td>0.961</td>
      <td>0.953</td>
    </tr>
    <tr>
      <td>stiebel_eltron_isg_hot_gas_temperature_wp1</td>
      <td>heating</td>
      <td>7.745</td>
      <td>-0.927</td>
      <td>0.919</td>
    </tr>
    <tr>
      <td>stiebel_eltron_isg_actual_temperature_hk_2</td>
      <td>heating</td>
      <td>7.694</td>
      <td>-0.928</td>
      <td>0.914</td>
    </tr>
    <tr>
      <td>wp_anlage_hk2_ist</td>
      <td>heating</td>
      <td>7.571</td>
      <td>-0.930</td>
      <td>0.902</td>
    </tr>
    <tr>
      <td>total_consumption_kwh</td>
      <td>other</td>
      <td>99.643</td>
      <td>-0.881</td>
      <td>0.878</td>
    </tr>
    <tr>
      <td>wp_wp_vorlauf</td>
      <td>heating</td>
      <td>7.708</td>
      <td>-0.849</td>
      <td>0.838</td>
    </tr>
    <tr>
      <td>stiebel_eltron_isg_flow_temperature_wp1</td>
      <td>heating</td>
      <td>7.725</td>
      <td>-0.847</td>
      <td>0.838</td>
    </tr>
    <tr>
      <td>stiebel_eltron_isg_outdoor_temperature</td>
      <td>heating</td>
      <td>6.740</td>
      <td>0.965</td>
      <td>0.833</td>
    </tr>
    <tr>
      <td>wp_wp_fortluft</td>
      <td>heating</td>
      <td>6.723</td>
      <td>0.962</td>
      <td>0.828</td>
    </tr>
    <tr>
      <td>stiebel_eltron_isg_actual_temperature_hk_1</td>
      <td>heating</td>
      <td>7.691</td>
      <td>-0.840</td>
      <td>0.827</td>
    </tr>
  </tbody>
</table>
        <p><em>COP score = |cop_corr| × coverage_weight. Higher is better.</em></p>
    </div>

    <div class="card">
        <h4>Key Findings</h4>
        <table>
            <tr>
                <th>Sensor Type</th>
                <th>Coverage</th>
                <th>Potential Use</th>
                <th>Recommendation</th>
            </tr>
            <tr>
                <td><strong>Pressure sensors</strong></td>
                <td>7.7%</td>
                <td>Thermodynamic COP model via Carnot efficiency</td>
                <td>Need more data</td>
            </tr>
            <tr>
                <td><strong>Wind sensors</strong></td>
                <td>5.1%</td>
                <td>Infiltration losses in thermal model</td>
                <td>Need more data</td>
            </tr>
            <tr>
                <td><strong>Defrost indicator</strong></td>
                <td>0.4%</td>
                <td>Filter low-COP defrost periods</td>
                <td>Need more data</td>
            </tr>
        </table>
    </div>

    <div class="card">
        <h4>Methodology</h4>
        <p><strong>Correlation Analysis:</strong></p>
        <ul>
            <li><strong>Room temperature correlation:</strong> Pearson correlation between each sensor and davis_inside_temperature</li>
            <li><strong>Residual correlation:</strong> Correlation with thermal model residuals (actual - predicted). High values indicate the sensor captures dynamics the model misses.</li>
            <li><strong>COP correlation:</strong> Daily-averaged sensor values correlated with daily COP. Identifies sensors that explain efficiency variations.</li>
        </ul>
        <p><strong>Scoring:</strong></p>
        <ul>
            <li><code>coverage_weight = clip(coverage_pct / 100, 0.1, 1.0)</code></li>
            <li><code>thermal_score = |residual_corr| × coverage_weight</code></li>
            <li><code>cop_score = |cop_corr| × coverage_weight</code></li>
            <li><code>combined_score = 0.5 × thermal_score + 0.5 × cop_score</code></li>
            <li>Focus sensors receive a 20% score boost</li>
        </ul>
    </div>

    <div class="card">
        <h4>Recommendations for Future Modeling</h4>
        <ol>
            <li><strong>Thermodynamic COP model:</strong> Use high/low pressure sensors to compute theoretical Carnot COP:
                <pre style="background: #f5f5f5; padding: 0.5rem; margin: 0.5rem 0;">COP_carnot = T_hot / (T_hot - T_cold)</pre>
                where T_hot and T_cold are derived from pressure via refrigerant tables.</li>
            <li><strong>Defrost filtering:</strong> Exclude periods with evaporator_defrost=1 to reduce noise in COP analysis.
                Defrost cycles temporarily reduce COP but are not representative of normal operation.</li>
            <li><strong>Wind infiltration:</strong> Add wind speed as a thermal model input. High wind increases
                infiltration losses, reducing indoor temperature even when heating output is constant.</li>
            <li><strong>Compressor status:</strong> Use is_heating and compressor status for filtering heat-pump-only
                periods, excluding backup heater operation.</li>
        </ol>
    </div>

    <div class="figure">
        <img src="fig2.18_sensor_coverage.png" alt="Sensor Coverage Analysis">
        <div class="figure-caption">Sensor coverage analysis: data availability by category, top sensors, focus sensors, and overall distribution.</div>
    </div>

    <div class="figure">
        <img src="fig2.19_sensor_correlations.png" alt="Sensor Correlation Analysis">
        <div class="figure-caption">Correlation analysis: top correlations with room temperature (left), model residuals (center), and COP (right). Bottom row shows combined scores, pressure sensor dynamics, and focus sensor summary.</div>
    </div>
    

        <h2 id="battery">13. Battery Degradation</h2>
        <div class="card">
            <p>Analysis of whether the Feb-Mar 2025 deep-discharge event affected battery efficiency.</p>
            <details>
                <summary>View Full Battery Degradation Report</summary>
                <iframe srcdoc="" style="width: 100%; height: 800px; border: none;"></iframe>
            </details>
        </div>

        <h2 id="log">14. Detailed Log</h2>

        <details>
            <summary>Full EDA Output Log</summary>
            <pre>============================================================
PHASE 2: EXPLORATORY DATA ANALYSIS
============================================================
Loading processed data...
  Using prepared room data (filtered/mapped by wrapper)
  energy_15min: 101,184 rows, 2023-03-01 00:15:00 to 2026-01-18 00:00:00
  energy_daily: 1,037 rows, 2023-03-01 00:00:00 to 2025-12-31 00:00:00
  energy_monthly: 36 rows, 2023-01-01 00:00:00 to 2025-12-01 00:00:00
  heating: 2,155,442 rows, 2025-10-28 16:25:39.040786+00:00 to 2026-01-18 07:53:30.406130+00:00
  weather: 1,261,116 rows, 2025-10-28 16:25:41.367035+00:00 to 2026-01-18 07:53:55.193825+00:00
  rooms: 76,104 rows, 2025-10-28 16:25:41.367413+00:00 to 2026-01-18 07:52:19.172731+00:00
  integrated: 7,807 rows, 2025-10-28 16:30:00+00:00 to 2026-01-18 00:00:00+00:00

============================================================
2.1 ENERGY PATTERNS ANALYSIS
============================================================
  Saved: fig2.01_daily_energy_timeseries.png
  Saved: fig2.02_monthly_energy_patterns.png
  Saved: fig2.03_hourly_heatmaps.png
  Saved: fig2.04_seasonal_patterns.png

  Summary Statistics:
    Data period: 2023-03-01 to 2025-12-31
    Total days: 1037

    Daily averages:
      PV Generation:     55.9 kWh/day
      Total Consumption: 24.6 kWh/day
      Grid Import:       10.2 kWh/day
      Grid Export:       41.0 kWh/day
      Self-Sufficiency:  43.8%

============================================================
2.2 HEATING SYSTEM ANALYSIS
============================================================
  Saved: fig2.05_heat_pump_cop.png

  COP Model Comparison:
  ----------------------------------------------------------------------
  Model                           R²     RMSE  β_outdoor    β_T_HK2
  ----------------------------------------------------------------------
  Stiebel outdoor only         0.793    0.259     0.1584          —
  Davis outdoor only           0.718    0.296     0.1294          —
  Stiebel outdoor + T_HK2      0.795    0.257     0.1184    -0.0457
  Davis outdoor + T_HK2        0.758    0.274     0.0246    -0.1443
  ----------------------------------------------------------------------

  Best model: Stiebel outdoor + T_HK2
    COP = 4.45 + 0.1184×T_outdoor + -0.0457×T_HK2
    R² = 0.795, RMSE = 0.257

  Adding T_HK2 improves Stiebel model R² by 0.003 (0.3%)
  Saved: fig2.06_temperature_differentials.png
  Saved: fig2.07_indoor_outdoor_temp.png

  Heat Pump COP Statistics:
    Mean COP:   3.48
    Median COP: 3.52
    Min COP:    2.34
    Max COP:    5.18

  Daily Heating Electricity:
    Mean:   25.7 kWh/day
    Median: 22.5 kWh/day
    Max:    58.0 kWh/day

  Saved COP models to: /Users/stata/workspace/estat/output/phase2/cop_models.json

============================================================
2.3 SOLAR-HEATING CORRELATION
============================================================
  Saved: fig2.08_solar_heating_hourly.png
  Saved: fig2.09_battery_evening_heating.png
  Saved: fig2.10_forced_grid_heating.png

  Solar-Heating Overlap Analysis:
    Solar hours (8AM-5PM):
      Heating active: 51.1% of time
      Avg grid import: 0.89 kWh/h
    Non-solar hours (5PM-8AM):
      Heating active: 49.0% of time
      Avg grid import: 1.45 kWh/h

  Forced Grid Consumption:
    % of heating time with forced grid: 4.8%

============================================================
2.4 SUMMARY STATISTICS
============================================================
  Saved: fig2.11_summary_statistics.png

  Summary:
    Energy period: 2023-03-01 to 2025-12-31 (1037 days)
    Self-sufficiency: 44%
    Best season: Summer (63%)
    Worst season: Winter (19%)

============================================================
Phase 2 EDA complete. Output saved to: /Users/stata/workspace/estat/output/phase2/
============================================================
</pre>
        </details>

        <details>
            <summary>Heating Curve Analysis Log</summary>
            <pre>============================================================
HEATING CURVE ANALYSIS
============================================================
Loading heating sensor data...
  Loaded 2,155,442 rows, 96 sensors
  Date range: 2025-10-28 16:25:39.040786+00:00 to 2026-01-18 07:53:30.406130+00:00

Detecting setpoint regimes...
  Found 21 setpoint regimes:
    2025-10-28 17:25: comfort=20.5°C, eco=nan°C
    2025-10-28 17:25: comfort=20.5°C, eco=18.7°C
    2025-10-29 07:39: comfort=20.5°C, eco=18.5°C
    2025-10-29 10:35: comfort=20.5°C, eco=18.3°C
    2025-11-03 00:07: comfort=20.3°C, eco=18.3°C
    2025-11-04 15:09: comfort=20.2°C, eco=18.3°C
    2025-11-04 15:09: comfort=20.2°C, eco=18.2°C
    2025-11-25 23:55: comfort=20.2°C, eco=18.0°C
    2025-12-04 15:48: comfort=20.2°C, eco=30.0°C
    2025-12-07 09:59: comfort=20.2°C, eco=18.0°C
    2025-12-14 10:23: comfort=20.5°C, eco=18.0°C
    2025-12-25 14:25: comfort=20.7°C, eco=18.0°C
    2025-12-27 10:29: comfort=21.0°C, eco=18.0°C
    2025-12-30 22:22: comfort=20.7°C, eco=18.0°C
    2025-12-31 10:27: comfort=21.0°C, eco=18.0°C
    2026-01-12 10:01: comfort=23.0°C, eco=18.0°C
    2026-01-12 10:01: comfort=23.0°C, eco=15.0°C
    2026-01-13 23:05: comfort=23.0°C, eco=14.0°C
    2026-01-13 23:21: comfort=21.0°C, eco=14.0°C
    2026-01-17 12:21: comfort=20.5°C, eco=14.0°C
    2026-01-17 12:21: comfort=20.5°C, eco=17.0°C

Pivoting data for transition detection...

Detecting schedule transitions...
  Found 150 transitions
    Morning (ECO→COMFORT): 77
    Evening (COMFORT→ECO): 73

Estimating schedule regimes...
  Found 5 schedule regimes:
    2025-10-30 to 2025-12-26: Comfort 06:30 - 20:00 (46 days)
    2025-12-27 to 2026-01-07: Comfort 06:30 - 21:30 (10 days)
    2026-01-08 to 2026-01-08: Comfort 06:30 - 09:00 (1 days)
    2026-01-09 to 2026-01-13: Comfort 06:30 - 21:30 (3 days)
    2026-01-16 to 2026-01-16: Comfort 06:00 - 21:30 (1 days)

  Saved: heating_curve_schedules.csv
  Saved: heating_curve_setpoints.csv

Building heating curve model...
  Note: 657 rows (2.5%) have eco &gt;= comfort (anomalous)
  Analysis dataset: 26,729 rows
  Comfort mode: 15,591 (58.3%)
  Eco mode: 11,138 (41.7%)
  Estimated T_ref (comfort): 21.34°C
  Estimated T_ref (eco): 19.16°C

  Model Performance (normal periods, n=26,072):
    R-squared: 0.9460
    RMSE: 1.02°C
    RMSE (comfort): 0.52°C
    RMSE (eco): 1.45°C

  Anomalous periods (eco &gt;= comfort, n=657):
    RMSE: 5.09°C (expected - using actual setpoint)

  Overall (all data):
    R-squared: 0.9207
    RMSE: 1.28°C

  Performance by setpoint regime:
    2025-10-28: comfort=20.5°C, eco=18.7°C, RMSE=1.04°C (n=245)
    2025-10-29: comfort=20.5°C, eco=18.5°C, RMSE=0.41°C (n=36)
    2025-10-29: comfort=20.5°C, eco=18.3°C, RMSE=0.69°C (n=1,639)
    2025-11-03: comfort=20.3°C, eco=18.3°C, RMSE=0.55°C (n=597)
    2025-11-04: comfort=20.2°C, eco=18.2°C, RMSE=0.50°C (n=7,380)
    2025-11-25: comfort=20.2°C, eco=18.0°C, RMSE=0.50°C (n=2,930)
    2025-12-04: comfort=20.2°C, eco=30.0°C, RMSE=5.09°C (n=656)
    2025-12-07: comfort=20.2°C, eco=18.0°C, RMSE=0.36°C (n=2,392)
    2025-12-14: comfort=20.5°C, eco=18.0°C, RMSE=0.60°C (n=3,714)
    2025-12-25: comfort=20.7°C, eco=18.0°C, RMSE=0.78°C (n=540)
    2025-12-27: comfort=21.0°C, eco=18.0°C, RMSE=0.66°C (n=1,156)
    2025-12-30: comfort=20.7°C, eco=18.0°C, RMSE=1.10°C (n=140)
    2025-12-31: comfort=21.0°C, eco=18.0°C, RMSE=1.55°C (n=3,549)
    2026-01-12: comfort=23.0°C, eco=15.0°C, RMSE=2.32°C (n=538)
    2026-01-13: comfort=23.0°C, eco=14.0°C, RMSE=3.78°C (n=5)
    2026-01-13: comfort=21.0°C, eco=14.0°C, RMSE=2.88°C (n=977)
    2026-01-17: comfort=20.5°C, eco=17.0°C, RMSE=2.03°C (n=233)
  Saved: heating_curve_params.json

Creating visualization...
  Saved: fig2.12_heating_curve_schedule.png
  Saved: fig2.12a_heating_curve_censored.png
  Saved: heating_curve_report_section.html

============================================================
Heating curve analysis complete.
============================================================
</pre>
        </details>

        <details>
            <summary>Weighted Temperature Analysis Log</summary>
            <pre>============================================================
WEIGHTED TEMPERATURE ANALYSIS
============================================================
Loading heating sensor data...
  Loaded 2,155,442 rows, 96 sensors
  Date range: 2025-10-28 16:25:39.040786+00:00 to 2026-01-18 07:53:30.406130+00:00
Loading room sensor data...
  Loaded 94,537 rows, 25 sensors

Computing weighted indoor temperature...
  davis_inside_temperature: 4,578 valid readings (weight=100%)
  Weighted temperature: 4,578 valid readings
  Range: 16.3°C to 21.8°C
  Mean: 19.0°C

Detecting parameter regimes...
  Found 38 parameter regimes:
    2025-10-28 17:25: comfort=20.5°C, eco=nan°C, curve=nan
    2025-10-28 17:25: comfort=20.5°C, eco=18.7°C, curve=nan
    2025-10-28 17:25: comfort=20.5°C, eco=18.7°C, curve=1.14
    2025-10-29 07:39: comfort=20.5°C, eco=18.5°C, curve=1.14
    2025-10-29 10:35: comfort=20.5°C, eco=18.3°C, curve=1.14
    2025-11-03 00:07: comfort=20.3°C, eco=18.3°C, curve=1.14
    2025-11-03 00:08: comfort=20.3°C, eco=18.3°C, curve=1.10
    2025-11-03 00:09: comfort=20.3°C, eco=18.3°C, curve=1.11
    2025-11-04 15:09: comfort=20.2°C, eco=18.3°C, curve=1.11
    2025-11-04 15:09: comfort=20.2°C, eco=18.2°C, curve=1.11
    ... and 28 more

Creating washout mask (48h after each regime change)...
  Washout periods: 2,726 readings (34.8%)
  Analysis periods: 5,113 readings (65.2%)

Building analysis dataset...
  Dataset: 4,578 rows
  Date range: 2025-10-28 16:15:00+00:00 to 2026-01-18 07:00:00+00:00
  Washout periods: 1,681 rows
  Analysis data: 2,897 rows

Computing regime statistics...
  Computed statistics for 10 regimes

Building multivariate regression model...
  Daily aggregates: 61 days

  Model Results (R² = 0.567, Adj R² = 0.527, RMSE = 0.51°C):
  Parameter                Coef       SE        t        p
  ----------------------------------------------------
  intercept             -15.789    7.784    -2.03  0.0474 *
  comfort_setpoint        1.225    0.318     3.85  0.0003 ***
  eco_setpoint           -0.061    0.032    -1.89  0.0637 
  curve_rise              9.627    1.632     5.90  0.0000 ***
  comfort_hours           0.035    0.031     1.12  0.2674 
  outdoor_mean            0.079    0.022     3.65  0.0006 ***

  Interpretation (controlling for other variables):
    +1°C comfort setpoint → +1.22°C T_weighted
    +1°C eco setpoint → -0.06°C T_weighted
    +0.1 curve rise → +0.96°C T_weighted
    +1h comfort duration → +0.03°C T_weighted
    +1°C outdoor temp → +0.08°C T_weighted

Computing simple correlations (for reference)...

Saving outputs...
  Saved: weighted_temp_regimes.csv
  Saved: weighted_temp_sensitivity.csv
  Saved: weighted_temp_model.csv

Creating visualization...
  Saved: fig2.13_weighted_temp_parameters.png
  Saved: weighted_temp_report_section.html

============================================================
Weighted temperature analysis complete.
============================================================
</pre>
        </details>

        <details>
            <summary>Tariff Analysis Log</summary>
            <pre>============================================================
Phase 2, Step 4: Electricity Tariff Analysis
============================================================
Loading tariff data...
  Schedule: 26 entries
  Flags: 27025 hourly records
  Series: 27025 hourly records

Filtered tariffs (HKN-only for feed-in):
  Purchase: 9 entries
  Feed-in (with HKN): 11 entries
  Excluded: 6 base-only entries

Generating figures...
  Creating tariff timeline figure...
  Creating tariff windows figure...
  Creating cost implications figure...

Generating report section...
  Saved: /Users/stata/workspace/estat/output/phase2/tariff_report_section.html

============================================================
Tariff Analysis Complete
============================================================

Outputs saved to: /Users/stata/workspace/estat/output/phase2
  - fig2.14_tariff_timeline.png
  - fig2.15_tariff_windows.png
  - fig2.16_tariff_costs.png
  - tariff_report_section.html
</pre>
        </details>

        <details>
            <summary>HK2 Target vs Actual Analysis Log</summary>
            <pre>============================================================
Phase 2, Step 6: HK2 Target vs Actual Temperature Analysis
============================================================
Loading heating sensor data...
  Loaded 2,155,442 rows, 96 sensors
  Wide format: 7,839 rows, 96 columns
  Date range: 2025-10-28 16:15:00+00:00 to 2026-01-18 07:45:00+00:00

Preparing HK2 data...
  Target column (stiebel_eltron_isg_target_temperature_hk_2): found
  Actual column (stiebel_eltron_isg_actual_temperature_hk_2): found
  Actual alt column (wp_anlage_hk2_ist): found
  Outdoor column (stiebel_eltron_isg_outdoor_temperature): found
  Using actual column: stiebel_eltron_isg_actual_temperature_hk_2
  Valid observations: 6,542
  Period: 2025-10-28 to 2026-01-18

Analyzing deviation statistics...
  Mean deviation: -1.42°C
  Std deviation: 1.85°C
  Actual above target: 15.2%
  Within ±1°C: 52.2%
  Within ±2°C: 69.8%
  Correlation: 0.913

Fitting first-order lag model...
  Optimal time constant τ: 0.37 hours
  Forward simulation: R² = 0.748, RMSE = 2.24°C
  One-step prediction: R² = 0.842, RMSE = 1.77°C

Analyzing cross-correlation...
  Peak correlation: 0.920 at lag -0.25 hours
  Zero-lag correlation: 0.913

Creating visualization...
  Saved: fig2.17_hk2_target_actual.png

Saved: hk2_target_actual_stats.csv
Saved: hk2_target_actual_report_section.html

============================================================
HK2 TARGET VS ACTUAL ANALYSIS SUMMARY
============================================================

Deviation Statistics:
  Mean (actual - target): -1.42°C
  Std deviation: 1.85°C
  Correlation: 0.913

Lag Model:
  Time constant τ: 0.37 hours
  Forward R²: 0.748
  Forward RMSE: 2.24°C

⚠ Lag model has moderate fit - consider additional factors
</pre>
        </details>

        <details>
            <summary>Sensor Exploration Log</summary>
            <pre>============================================================
Phase 2, Step 6: Sensor Exploration
============================================================
Loading sensor summary...
  190 sensors across 4 categories
Loading integrated dataset...
  101,215 rows, 198 columns
  Period: 2023-03-01 to 2026-01-18
Loading thermal model residuals...
  Loaded 6,807 residual values
Loading COP data...
  Loaded 83 daily COP values

Computing coverage statistics...
  Analyzed 198 sensors in integrated dataset
  High coverage (&gt;80%): 8 sensors
  High overlap coverage (&gt;80%): 37 sensors
  Focus sensors with data: 13

Computing correlations with room temperature...
  Computed 154 correlations
  Strongest: davis_inside_temperature (r=1.000)

Computing correlations with model residuals...
  Computed 157 correlations
  Strongest: temphum_woz_temperature (r=0.585)

Computing COP correlations (daily resolution)...

Computing correlations with daily COP...
  Computed 142 correlations
  Strongest: stiebel_eltron_isg_outdoor_temperature (r=0.965)

Ranking sensors by improvement potential...
  Top 5 sensors for thermal improvement:
    stiebel_eltron_isg_low_pressure_wp1: score=0.022, resid_corr=0.022
    stiebel_eltron_isg_hot_gas_temperature_wp1: score=0.026, resid_corr=-0.026
    total_consumption_kwh: score=0.159, resid_corr=0.160
    stiebel_eltron_isg_flow_temperature_wp1: score=0.019, resid_corr=-0.020
    stiebel_eltron_isg_actual_temperature_hk_2: score=0.031, resid_corr=0.031

Creating coverage visualization...
  Saved: fig2.18_sensor_coverage.png

Creating correlation visualization...
  Saved: fig2.19_sensor_correlations.png

Saved: sensor_exploration_rankings.csv

Generating HTML report section...
Saved: sensor_exploration_report_section.html

============================================================
SUMMARY
============================================================

Sensors analyzed: 198
High coverage (&gt;80%): 8

Top 5 sensors for improvement:
  64. stiebel_eltron_isg_low_pressure_wp1
     Coverage: 7.7%, Score: 0.585
  59. stiebel_eltron_isg_hot_gas_temperature_w
     Coverage: 7.7%, Score: 0.567
  4. total_consumption_kwh
     Coverage: 99.6%, Score: 0.519
  51. stiebel_eltron_isg_flow_temperature_wp1
     Coverage: 7.7%, Score: 0.514
  30. stiebel_eltron_isg_actual_temperature_hk
     Coverage: 7.7%, Score: 0.472
</pre>
        </details>

    </div>

    <div class="footer">
        <p>ESTAT - Energy System Analysis | Phase 2: Exploratory Data Analysis</p>
    </div>
</body>
</html>