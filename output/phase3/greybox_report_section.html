
    <section id="greybox-thermal-model">
    <h2>3.1b Grey-Box Thermal Model</h2>

    <h3>Model Formulation</h3>
    <p>A physics-based discrete-time state-space model with two states:</p>

    <h4>State Variables</h4>
    <ul>
        <li><strong>T_buffer</strong>: Buffer tank temperature (intermediate thermal storage)</li>
        <li><strong>T_room</strong>: Room/indoor temperature (comfort objective)</li>
    </ul>

    <h4>Discrete-Time Equations (dt = 15 min)</h4>
    <pre>
T_buffer[k+1] = T_buffer[k] + (dt/tau_buf) × [(T_HK2[k] - T_buffer[k]) - r_emit × (T_buffer[k] - T_room[k])]

T_room[k+1] = T_room[k] + (dt/tau_room) × [r_heat × (T_buffer[k] - T_room[k]) - (T_room[k] - T_outdoor[k])] + k_solar × PV[k]
    </pre>

    <h3>Estimated Parameters</h3>
    <table>
        <tr>
            <th>Parameter</th>
            <th>Value</th>
            <th>Std Error</th>
            <th>Bounds</th>
        </tr>
        
        <tr>
            <td><code>tau_buf</code></td>
            <td>2.276</td>
            <td>+/- 0.119</td>
            <td>[0.5, 4.0]</td>
        </tr>
        
        <tr>
            <td><code>tau_room</code></td>
            <td>72.000</td>
            <td>+/- 44.875</td>
            <td>[12.0, 72.0]</td>
        </tr>
        
        <tr>
            <td><code>r_emit</code></td>
            <td>0.100</td>
            <td>+/- 0.021</td>
            <td>[0.1, 3.0]</td>
        </tr>
        
        <tr>
            <td><code>r_heat</code></td>
            <td>1.047</td>
            <td>+/- 0.601</td>
            <td>[0.1, 3.0]</td>
        </tr>
        
        <tr>
            <td><code>k_solar</code></td>
            <td>0.017</td>
            <td>+/- 0.021</td>
            <td>[0.0, 2.0]</td>
        </tr>
        
        <tr>
            <td><code>c_offset</code></td>
            <td>-0.085</td>
            <td>+/- 0.113</td>
            <td>[-3.0, 3.0]</td>
        </tr>
        
    </table>

    <h3>Physical Interpretation</h3>
    <ul>
        <li><strong>tau_buf = 2.28h</strong>: Buffer tank responds to heat pump input
            with time constant of ~137 minutes</li>
        <li><strong>tau_room = 72.0h</strong>: Building thermal mass gives
            ~72-hour time constant for room temperature</li>
        <li><strong>r_emit = 0.10</strong>: Ratio of heat transfer from buffer to room
            vs heat input from heat pump</li>
        <li><strong>r_heat = 1.05</strong>: Ratio of heat transfer from buffer to room
            vs heat loss to outdoors</li>
        <li><strong>k_solar = 0.017 K/kWh</strong>: Room gains 0.02°C
            per kWh of PV generation (proxy for solar irradiance)</li>
    </ul>

    <h3>Fit Statistics (Training Set)</h3>
    <table>
        <tr>
            <th>Metric</th>
            <th>Buffer Tank</th>
            <th>Room</th>
        </tr>
        <tr>
            <td>R²</td>
            <td>0.791</td>
            <td><strong>0.995</strong></td>
        </tr>
        <tr>
            <td>RMSE</td>
            <td>2.73°C</td>
            <td><strong>0.06°C</strong></td>
        </tr>
        <tr>
            <td>MAE</td>
            <td>2.25°C</td>
            <td>0.05°C</td>
        </tr>
        <tr>
            <td>Bias</td>
            <td>-0.536°C</td>
            <td>-0.000°C</td>
        </tr>
    </table>

    <h3>Validation (Test Set)</h3>
    <table>
        <tr>
            <th>Metric</th>
            <th>Buffer Tank</th>
            <th>Room</th>
        </tr>
        <tr>
            <td>R²</td>
            <td>0.704</td>
            <td><strong>0.992</strong></td>
        </tr>
        <tr>
            <td>RMSE</td>
            <td>2.87°C</td>
            <td><strong>0.07°C</strong></td>
        </tr>
        <tr>
            <td>Bias</td>
            <td>—</td>
            <td>-0.008°C</td>
        </tr>
    </table>

    <h3>Residual Diagnostics</h3>
    <ul>
        <li><strong>Durbin-Watson</strong>: 1.46
            (ideal = 2.0; &lt;1.5 indicates positive autocorrelation)</li>
        <li><strong>Decorrelation lag</strong>: 1.2 hours
            (residuals become uncorrelated after this time)</li>
        <li><strong>Residual std</strong>: 0.064°C</li>
    </ul>

    <h3>Comparison with Transfer Function Model</h3>
    <p>The grey-box model provides:</p>
    <ul>
        <li><strong>Explicit buffer tank modeling</strong>: Captures intermediate thermal storage dynamics</li>
        <li><strong>Physical parameters</strong>: Time constants and heat transfer ratios with clear interpretation</li>
        <li><strong>Constrained estimation</strong>: Parameters bounded to physically plausible ranges</li>
    </ul>

    <figure>
        <img src="fig17b_greybox_model.png" alt="Grey-Box Thermal Model Results">
        <figcaption><strong>Figure 17b:</strong> Grey-box thermal model: state trajectories (top-left),
        actual vs predicted scatter (top-right), residual distribution (bottom-left),
        model comparison (bottom-right).</figcaption>
    </figure>
    </section>
    